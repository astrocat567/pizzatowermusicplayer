<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Music Player</title>
<style>
    body {
        margin: 0;
        background: #0a0a0c;
        font-family: Arial, sans-serif;
        color: white;
        overflow-x: hidden;
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    #carousel {
        position: relative;
        width: 100%;
        height: 70vh;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
    }

    .cover {
        position: absolute;
        width: 260px;
        height: 260px;
        background-size: cover;
        background-position: center;
        border-radius: 16px;
        transition: all 0.35s ease;
        opacity: 0;
    }

    .center {
        transform: scale(1);
        opacity: 1 !important;
        z-index: 3;
    }

    .left, .right {
        transform: scale(0.7);
        opacity: 0.3;
        z-index: 2;
    }

    .left {
        left: 15%;
    }

    .right {
        right: 15%;
    }

    #player {
        width: 100%;
        text-align: center;
        margin-top: 20px;
    }

    #title {
        font-size: 22px;
        margin-bottom: 6px;
    }

    #progress {
        width: 60%;
        margin: 10px auto;
    }

    #controls {
        margin-top: 10px;
        display: flex;
        justify-content: center;
        gap: 20px;
    }

    button {
        background: #1a1a1d;
        border: none;
        color: white;
        padding: 10px 20px;
        font-size: 22px;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s;
    }

    button:hover {
        background: #333;
    }

    #repeat.active {
        color: #7db7ff;
    }
</style>
</head>
<body>

<div id="carousel"></div>

<div id="player">
    <div id="title">Loading…</div>
    <input type="range" id="progress" value="0" min="0" max="100">
    
    <div id="controls">
        <button id="prev">&lt;</button>
        <button id="playpause">▶</button>
        <button id="next">&gt;</button>
        <button id="repeat">↻</button>
    </div>
</div>

<audio id="audio"></audio>

<script>
// Remove file extensions from track titles
function cleanTitle(filename) {
    return filename.replace(/\.[^/.]+$/, "");
}

// Load tracks from the /tracks/ folder
async function loadTracks() {
    const req = await fetch("tracks/");
    const text = await req.text();

    // GitHub Pages returns directory HTML listing
    const parser = new DOMParser();
    const doc = parser.parseFromString(text, "text/html");

    const links = [...doc.querySelectorAll("a")];
    const audioFiles = links
        .map(a => a.getAttribute("href"))
        .filter(h => h && (h.endsWith(".mp3") || h.endsWith(".wav") || h.endsWith(".ogg")))
        .map(file => "tracks/" + file);

    return audioFiles;
}

let tracks = [];
let index = 0;
let repeat = false;

const audio = document.getElementById("audio");
const title = document.getElementById("title");
const progress = document.getElementById("progress");
const playpause = document.getElementById("playpause");
const repeatBtn = document.getElementById("repeat");

const carousel = document.getElementById("carousel");

function updateCarousel() {
    carousel.innerHTML = "";

    const coverCenter = document.createElement("div");
    coverCenter.className = "cover center";
    coverCenter.style.backgroundImage = "url('pts.jpeg')";
    carousel.appendChild(coverCenter);

    if (tracks.length > 1) {
        const leftIndex = (index - 1 + tracks.length) % tracks.length;
        const rightIndex = (index + 1) % tracks.length;

        const left = document.createElement("div");
        left.className = "cover left";
        left.style.backgroundImage = "url('pts.jpeg')";
        carousel.appendChild(left);

        const right = document.createElement("div");
        right.className = "cover right";
        right.style.backgroundImage = "url('pts.jpeg')";
        carousel.appendChild(right);
    }
}

function loadSong(i) {
    index = (i + tracks.length) % tracks.length;
    const src = tracks[index];

    audio.src = src;
    title.textContent = cleanTitle(src.split("/").pop());
    updateCarousel();
    audio.play();
    playpause.textContent = "⏸";
}

playpause.onclick = () => {
    if (audio.paused) {
        audio.play();
        playpause.textContent = "⏸";
    } else {
        audio.pause();
        playpause.textContent = "▶";
    }
};

document.getElementById("next").onclick = () => loadSong(index + 1);
document.getElementById("prev").onclick = () => loadSong(index - 1);

repeatBtn.onclick = () => {
    repeat = !repeat;
    repeatBtn.classList.toggle("active");
};

audio.onended = () => {
    if (repeat) loadSong(index);
    else loadSong(index + 1);
};

audio.ontimeupdate = () => {
    if (audio.duration) {
        progress.value = (audio.currentTime / audio.duration) * 100;
    }
};

progress.oninput = () => {
    if (audio.duration) {
        audio.currentTime = (progress.value / 100) * audio.duration;
    }
};

// Startup
(async () => {
    tracks = await loadTracks();
    if (tracks.length === 0) {
        title.textContent = "No audio files found in /tracks/";
        return;
    }
    loadSong(0);
})();
</script>

</body>
</html>

</script>

</body>
</html>
