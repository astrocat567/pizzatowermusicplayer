<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Music Player</title>
  <style>
    body { font-family: sans-serif; padding: 1em; }
    .track {
      display: flex;
      align-items: center;
      margin-bottom: 1em;
    }
    .track .cover {
      width: 64px;
      height: 64px;
      margin-right: 1em;
    }
    .track .title {
      flex: 1;
      margin-right: 1em;
      font-weight: bold;
    }
    audio {
      width: 200px;
    }
  </style>
</head>
<body>
  <h1>My Music Player</h1>
  <div id="playlist"></div>

  <script>
    // Derive owner and repo from URL (username.github.io or username.github.io/repo)
    let host = window.location.hostname;
    let owner = host.split('.')[0];
    let pathParts = window.location.pathname.split('/').filter(p => p);
    let repo = pathParts.length ? pathParts[0] : owner;

    let apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/tracks`;
    fetch(apiUrl)
      .then(res => { if (!res.ok) throw new Error("Cannot fetch tracks"); return res.json(); })
      .then(files => {
        files.filter(f => f.type === 'file' && f.name.match(/\.(mp3|ogg|wav)$/i))
             .forEach(file => {
          let div = document.createElement('div');
          div.className = 'track';

          let img = document.createElement('img');
          img.src = 'pts.jpeg';
          img.alt = 'Cover';
          img.className = 'cover';
          div.appendChild(img);

          let title = document.createElement('span');
          title.textContent = file.name;
          title.className = 'title';
          div.appendChild(title);

          let audio = document.createElement('audio');
          audio.controls = true;
          audio.preload = 'none';
          audio.src = file.download_url;
          div.appendChild(audio);

          document.getElementById('playlist').appendChild(div);
        });
      })
      .catch(err => console.error(err));
  </script>
</body>
</html>
